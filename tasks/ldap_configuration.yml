---
- name: Configure LDAP Local SSF
  ldap_attr:
    dn: 'cn=config'
    name: 'olcLocalSSF'
    values: '{{ slapd_ldap_local_ssf }}'
    state: 'exact'

- name: Configure LDAP connection security
  ldap_attr:
    dn: 'olcDatabase={1}{{ slapd_backend }},cn=config'
    name: 'olcSecurity'
    values: '{{ slapd_ldap_security }}'
    state: 'exact'
  notify: [ 'Restart slapd' ]

- name: Configure LDAP indices
  ldap_attr:
    dn: 'olcDatabase={1}{{ slapd_backend }},cn=config'
    name: 'olcDbIndex'
    values: '{{ slapd_ldap_index }}'
    state: 'exact'

- name: Configure LDAP Access Control List
  ldap_attr:
    dn: 'olcDatabase={1}{{ slapd_backend }},cn=config'
    name: 'olcAccess'
    values: '{{ lookup("template", "lookup/slapd_ldap_access_control_list.j2") | from_yaml }}'
    state: 'exact'

- name: Configure LDAP read only flag
  ldap_attr:
    dn: 'olcDatabase={1}{{ slapd_backend }},cn=config'
    name: 'olcReadOnly'
    values: "{{ 'TRUE' if slapd_read_only else 'FALSE' }}"
    state: 'exact'
